<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>오늘의 룸메이트 규칙</title>
    <style>
      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        max-width: 600px;
        margin: 0 auto;
        padding: 20px;
        background-color: #f8f9fa;
      }
      .header {
        text-align: center;
        margin-bottom: 30px;
        padding: 20px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-radius: 15px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      }
      .header h1 {
        margin: 0;
        font-size: 2em;
      }
      .date {
        margin-top: 10px;
        font-size: 1.2em;
        opacity: 0.9;
      }
      .rule-card {
        background: white;
        padding: 20px;
        margin: 15px 0;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        border-left: 4px solid #667eea;
        transition: transform 0.2s;
      }
      .rule-card:hover {
        transform: translateY(-2px);
      }
      .rule-content {
        font-size: 1.1em;
        color: #333;
        margin-bottom: 10px;
      }
      .rule-info {
        display: flex;
        justify-content: space-between;
        align-items: center;
        color: #666;
        font-size: 0.9em;
      }
      .week-number {
        background: #667eea;
        color: white;
        padding: 4px 8px;
        border-radius: 12px;
        font-size: 0.8em;
      }
      .no-rules {
        text-align: center;
        padding: 40px;
        color: #666;
        font-size: 1.1em;
      }
      .no-rules-icon {
        font-size: 3em;
        margin-bottom: 20px;
        opacity: 0.5;
      }
      .space-selector {
        text-align: center;
        margin-bottom: 20px;
      }
      .space-selector select {
        padding: 10px 15px;
        border: 2px solid #667eea;
        border-radius: 25px;
        font-size: 1em;
        background: white;
        cursor: pointer;
      }
      .refresh-btn {
        background: #667eea;
        color: white;
        border: none;
        padding: 8px 16px;
        border-radius: 20px;
        cursor: pointer;
        margin-left: 10px;
        font-size: 0.9em;
      }
      .refresh-btn:hover {
        background: #5a6fd8;
      }
    </style>
  </head>
  <body>
    <div class="header">
      <h1>🏠 오늘의 룸메이트 규칙</h1>
      <div class="date" id="todayDate"></div>
    </div>

    <div class="space-selector">
      <label for="spaceSelect">스페이스 선택: </label>
      <select id="spaceSelect" onchange="loadTodayRules()">
        <option value="1">스페이스 1</option>
        <option value="2">스페이스 2</option>
        <option value="3">스페이스 3</option>
      </select>
      <button class="refresh-btn" onclick="loadTodayRules()">
        🔄 새로고침
      </button>
    </div>

    <div id="rulesContainer">
      <!-- 여기에 오늘 규칙들이 표시됩니다 -->
    </div>

    <script>
      // 오늘 날짜 표시
      function updateTodayDate() {
        const today = new Date();
        const options = {
          year: "numeric",
          month: "long",
          day: "numeric",
          weekday: "long",
        };
        document.getElementById("todayDate").textContent =
          today.toLocaleDateString("ko-KR", options);
      }

      // 오늘 규칙 로드
      async function loadTodayRules() {
        const spaceId = document.getElementById("spaceSelect").value;
        const container = document.getElementById("rulesContainer");

        try {
          const response = await fetch(`/api/rules/space/${spaceId}/today`);
          if (response.ok) {
            const rules = await response.json();
            displayRules(rules);
          } else {
            const errorResponse = await response.json();
            let errorMessage = "오늘 규칙을 가져올 수 없습니다";
            if (errorResponse.message) {
              errorMessage += ": " + errorResponse.message;
            }
            showError(errorMessage);
          }
        } catch (error) {
          showError("네트워크 오류가 발생했습니다: " + error.message);
        }
      }

      // 규칙 표시
      function displayRules(rules) {
        const container = document.getElementById("rulesContainer");

        if (rules.length === 0) {
          container.innerHTML = `
                    <div class="no-rules">
                        <div class="no-rules-icon">🎉</div>
                        <div>오늘은 특별한 규칙이 없습니다!</div>
                        <div style="margin-top: 10px; font-size: 0.9em; opacity: 0.7;">
                            모든 규칙을 보려면 설정에서 확인하세요
                        </div>
                    </div>
                `;
        } else {
          container.innerHTML = rules
            .map(
              (rule) => `
                    <div class="rule-card">
                        <div class="rule-content">${rule.content}</div>
                        <div class="rule-info">
                            <span>${getWeekdayText(rule.weekdays)}</span>
                            <span class="week-number">${
                              rule.weekInterval
                            }주마다</span>
                        </div>
                    </div>
                `
            )
            .join("");
        }
      }

      // 요일 텍스트 변환
      function getWeekdayText(weekdays) {
        const weekdayMap = {
          MONDAY: "월요일",
          TUESDAY: "화요일",
          WEDNESDAY: "수요일",
          THURSDAY: "목요일",
          FRIDAY: "금요일",
          SATURDAY: "토요일",
          SUNDAY: "일요일",
        };

        return Array.from(weekdays)
          .map((day) => weekdayMap[day])
          .join(", ");
      }

      // 에러 표시
      function showError(message) {
        const container = document.getElementById("rulesContainer");
        container.innerHTML = `
                <div class="no-rules">
                    <div class="no-rules-icon">⚠️</div>
                    <div>${message}</div>
                </div>
            `;
      }

      // 페이지 로드 시 실행
      document.addEventListener("DOMContentLoaded", function () {
        updateTodayDate();
        loadTodayRules();
      });
    </script>
  </body>
</html>
